<!DOCTYPE html>
<html>
  <header><title>WROTiTT Forum</title></header>
  <head>
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  </head>
  
  <!-- Start of Main Body-->
  <body id="MainBod" style="background-color:black; min-height:100%">
    <style>
            div.a{
                text-align: center;
            }
    </style>
	  
    <!-- Title and Intro Div -->
    <div class="a" style="background-color:dimgrey ">
            <h1 class="multicolor" style="color:white;">WROTiTT</h1>
            <h2 class="multicolor" id="uName"></h2>
            <p></p>
    </div>
     
    <!-- Div containing 3 vertical divs -->
    <div style="background-color:dimgrey; min-height:100%">
      <!-- Social Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; min-height:100%;">
        <div class ="a" style="background-color: grey;">
            <h2 class ="multicolor">Social: Friends & Events</h2>
        </div>
            <h3 id = "correct_count">Correct Guesses</h3>
            <h2 id = "correct"></h2>
            <!-- <ul id = "correct-answers"></ul> -->

      </div>
      
      <!-- Posting and Feed div -->
      <div class ="a" style = "display: inline-block; *display: inline; width: 60%; background-color: silver; vertical-align: top; height:100%;">
            <h2 class ="multicolor">Feed: Posts & Comments</h2>
	    <p></p>
	    Welcome, <b id="UsrNme">--</b>
	    <p></p>
            Type what you want to post: <input type="text" id="post">
	    <button onclick = "printPost()">Post</button>
	    <p></p>
	    <!--"randomRackGenerator()">Post</button>-->
	    <button onclick = "clearPosts()">Clear</button>
	    <button onclick = "getPost()">Refresh Posts</button>
	    <p></p>
	    <table id="producttable">
  	      <thead>
    		<tr>
     		  <td style="background-color:grey; width: 15%;">UserName:</td>
      		  <td style="background-color:dimgrey; width: 8%;">Post Number</td>
		  <td style="background-color:darkgrey; width: 7%;">Likes</td>
      		  <td style="background-color:slategrey; width: 70%;">Post Text:</td>
   		</tr>
 	      </thead>
 	      <tbody>
   		 <!-- existing data could optionally be included here -->
 	      </tbody>
	    </table>
	      
	    <template id="productrow">
 	      <tr>
    		<td style="background-color:grey; width: 15%;"></td>
    		<td style="background-color:dimgrey; width: 8%;"></td>
		<td style="background-color:darkgrey; width: 7%;"></td>
		<td style="background-color:slategrey; width: 70%;"></td>
		<p></p>
		<button> Like </button>
  	      </tr>
	    </template>
	      
      </div>
      
      <!-- Profile Options Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; height: 100%;">
        <div class="a" style="background-color: grey;">
          <h2 class ="multicolor">User: Profile and Options</h2>
            </div>
	    <h3 id = "profName"></h3>
            Name: <input type = "text" id = "name">
            <button onclick = "submitName()">Change Name</button>
            <p></p>
            Customize Word Color: <input type = "color" id = "wordColor">
            <p></p>
      </div>
          
    </div>


    <!-- Script containing functions relavant to UI -->
    <script>
	var postCount = 0;
	var glblPostCount = 0;
	var postTime = 0.0;
	var postData = "";
	var usrName = "";
	var postLikes = 0;
	var postNumArr = [5,4,3,2,1];
	    
	var postNum = 0;
	var loadNum = 5;
	    
	var likedPostNum;
	var likedPostNum1;
	var likedPostNum2;
	var likedPostNum3;
	var likedPostNum4;
        
	var add_like = function(data){
	    console.log(data);
	    $.ajax({
                method: "PUT",
                url: "postHandle.php",
		data: {"postId" : data},
                success : function(data) {
		    //console.log(data);
		    //outPost(data);
		}
	    })
	    console.log("After PUT");
	}
	    
	var setName = function (data){
	    usrName = data;
	    //console.log("Set Post User Name");
	}
        // Gets a rack of 7 letters and puts it on screen
        var setPostNum = function (data){
            postCount = parseInt(data);
	    //console.log("Set Post Number");
        }

        // sets the count of words left to guess by length
        var setPostTime = function (data){
            postTime = data;
	    //console.log("Set Post Time");
        }

        // sets the count of correct guesses and correct guess list
        var setPostLikes = function (data){
            postLikes = data;
	    //console.log("Set Post Likes");
        }
	
        var setData = function (data){
            postData = data;
	    //console.log("Set Post Data");
        }
	    
	var getPost = function (evt){
	    var tbody = document.querySelector("tbody");
	    tbody.innerHTML = '';
	    console.log("Before GET");
	    $.ajax({
                method: "GET",
                url: "postHandle.php",
		data: {"postNum" : postNum},
                success : function(data) {
		    console.log(data);
		    outPost(data);
		}
	    })
	    console.log("After GET");
	}

	var outPost = function(data) {
	    for(postNum=0; postNum<20;postNum+=4){
		setName(data[postNum+1]);
		setPostNum(data[postNum]);
		setPostLikes(data[postNum+2]);
		setData(data[postNum+3]);
	    	if ('content' in document.createElement('template')) {
    	            // Instantiate the table with the existing HTML tbody
   	            // and the row with the template
    	            var tbody = document.querySelector("tbody");
    	            var template = document.querySelector('#productrow');
    		    // Clone the new row and insert it into the table
    	            var clone = template.content.cloneNode(true);
    	            var td = clone.querySelectorAll("td");
		    var butt = clone.querySelectorAll("button");
		    //const parsed = parseInt(postCount);
		    if((postNum/4)==0){
			likedPostNum = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum);}
		    }else if((postNum/4)==1){
			likedPostNum1 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum1);}
		    }else if((postNum/4)==2){
			likedPostNum2 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum2);}
		    }else if((postNum/4)==3){
			likedPostNum3 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum3);}
		    }else if((postNum/4)==4){
			likedPostNum4 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum4);}
		    }
		    butt[0].textContent = ("Likes!!");
    	            td[0].textContent = usrName;
	            td[0].nextSibling.nextSibling.textContent = postCount;
		    td[2].textContent = postLikes;
    	            td[3].textContent = postData;
		    //butt[0].onclick = add_like(butt[0].previousSibling.previousSibling.previousSibling.previousSibling.textContent);
			
		    postNumArr[(postNum/4)]=postCount;

    	            tbody.appendChild(clone);
    	        } else {
  	            // Find another way to add the rows to the table because
  	            // the HTML template element is not supported.
	        }
	    }
	}
		
	
        //function used to change introduction based on user input name
        var submitName = function (){
	    console.log("Changing Name");
            document.getElementById("uName").innerText = "What's on your mind, " + document.getElementById("name").value + "? Read / Write about it?" ;
	    document.getElementById("profName").innerText = document.getElementById("name").value + "'s Preferences:";
	    document.getElementById("UsrNme").innerText = document.getElementById("name").value;
            $.ajax({
                method: "POST",
                url: "cheatsheet.php",
                data: { "receiver_name": document.getElementById("name").value},
                success : function(data) {
                    
                }
            })
        }

        //function used to change the color of the headers based on user input
        var changeColorHandler = function (evt){
            let mycolor = evt.currentTarget.value
            var elements = document.getElementsByClassName("multicolor");
            for(var i=0; i<elements.length; i++){
              elements[i].style.color = mycolor;
            }
        }
	
	var clearPosts = function(){
	    var tbody = document.querySelector("tbody");
	    tbody.innerHTML = '';
	}
	
	var printPost = function (){
	    $.ajax({
                method: "POST",
                url: "postHandle.php",
                data: { "postName": document.getElementById("UsrNme").innerText, "postText": document.getElementById("post").value},
                success : function(data) {
                    
                }
            })
	    document.getElementById("post").value = "";
	    //getPost();
	}

        document.querySelector("#wordColor").addEventListener(
            "change",
            changeColorHandler
        )
        
    
    </script>
</body>
</html>
