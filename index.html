<!DOCTYPE html>
<html>
  <header><title>WROTiTT Forum</title></header>
  <head>
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  </head>
  
  <!-- Start of Main Body-->
  <body id="MainBod" style="background-color:black; min-height:100%">
    <style>
            div.a{
                text-align: center;
            }
    </style>
	  
    <!-- Title and Intro Div -->
    <div class="a" style="background-color:dimgrey ">
            <h1 class="multicolor" style="color:white;">WROTiTT</h1>
            <h2 class="multicolor" id="uName"></h2>
            <p></p>
    </div>
     
    <!-- Div containing 3 vertical divs -->
    <div style="background-color:dimgrey; min-height:100%">
      <!-- Social Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; min-height:100%;">
        <div class ="a" style="background-color: grey;">
            <h2 class ="multicolor">Social: Friends & Events</h2>
        </div>
            <h3 id = "correct_count">Correct Guesses</h3>
            <h2 id = "correct"></h2>
            <!-- <ul id = "correct-answers"></ul> -->

      </div>
      
      <!-- Posting and Feed div -->
      <div class ="a" style = "display: inline-block; *display: inline; width: 60%; background-color: silver; vertical-align: top; height:100%;">
            <h2 class ="multicolor">Feed: Posts & Comments</h2>
	    <p></p>
	    Welcome, <b id="UsrNme">--</b>
	    <p></p>
            Type what you want to post: <input type="text" id="post">
	    <p></p>
	    <!--"randomRackGenerator()">Post</button>-->
	    <button onclick = "printPost()">Post</button>
	    <button onclick = "newPost()">Load Post</button>
	    <p></p>
	    <table id="producttable">
  	      <thead>
    		<tr>
     		  <td style="background-color:grey; width: 20%;">UserName:</td>
      		  <td style="background-color:dimgrey; width: 10%;">Time / Post Number</td>
      		  <td style="background-color:slategrey; width: 70%;">Post Text:</td>
   		</tr>
 	      </thead>
 	      <tbody>
   		 <!-- existing data could optionally be included here -->
 	      </tbody>
	    </table>
	      
	    <template id="productrow">
 	      <tr>
    		<td class="record" style="background-color:grey; width: 20%;"></td>
    		<td style="background-color:dimgrey; width: 10%;"></td>
		<td style="background-color:slategrey; width: 70%;"></td>
		<p></p>
  	      </tr>
	    </template>
	      
      </div>
      
      <!-- Profile Options Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; height: 100%;">
        <div class="a" style="background-color: grey;">
          <h2 class ="multicolor">User: Profile and Options</h2>
            </div>
	    <h3 id = "profName"></h3>
            Name: <input type = "text" id = "name">
            <button onclick = "submitName()">Change Name</button>
            <p></p>
            Customize Word Color: <input type = "color" id = "wordColor">
            <p></p>
      </div>
          
    </div>


    <!-- Script containing functions relavant to UI -->
    <script>
	var postCount = 0;
	var glblPostCount = 0;
	var postTime = 0.0;
	var postData = "";
	var usrName = "";
	var postLikes = 0;
        
	var setName = function (data){
	    usrName = data;
	    console.log("data 0");
	}
        // Gets a rack of 7 letters and puts it on screen
        var setPostNum = function (data){
            postCount = data;
	    console.log("data 1");
        }

        // sets the count of words left to guess by length
        var setPostTime = function (data){
            postTime = data;
	    console.log("data 2");
        }

        // sets the count of correct guesses and correct guess list
        var setPostLikes = function (data){
            postLikes = data;
	    console.log("data 3");
        }
	
        var setData = function (data){
            postData = data;
	    console.log("data 4");
        }
	    
	var newPost = function (evt){
		console.log("Before GET");
		$.ajax({
                    method: "GET",
                    url: "postInfo.php",
                    data: { "User":usrName,"postNum":postCount,"pstTime":postTime,"pstLikes":postLikes,"pstData":postData},
                    success : function(data) {
		    console.log(data);
                    console.log(data[0]);
                    console.log(data[1]);
                    console.log(data[2]);
                    console.log(data[3]);
                    console.log(data[4]);
		    if(data != undefined && data != "Empty"){
			if(data[0] != null){
			    setName(data[0].User);
			    setPostNum(data[0].PostNumber);
			    setPostTime(data[0].PostTime);
			    setPostLikes(data[0].Likes);
			    setData(data[0].Data);
			}
			if(data[1] != null){
                            setPostNum(data[1].PostNumber);
                        }
                        if(data[3] != null){
                            setPostLikes(data[3].Likes);
                        }
                        if(data[2] != null){
                            setPostTime(data[2].PostTime);
                        }
                        if(data[4] != null){
                            setData(data[4].Data);
                        }
		    }
                    }
                 })
		console.log("After GET");
		

	}

        //function used to change introduction based on user input name
        var submitName = function (data){
	    console.log("Changing Name");
            document.getElementById("uName").innerText = "What's on your mind, " + document.getElementById("name").value + "? Read / Write about it?" ;
	    document.getElementById("profName").innerText = document.getElementById("name").value + "'s Preferences:";
	    document.getElementById("UsrNme").innerText = document.getElementById("name").value;
            $.ajax({
                method: "POST",
                url: "cheatsheet.php",
                data: { "receiver_name": document.getElementById("name").value},
                success : function(data) {
                    
                }
            })
        }

        //function used to change the color of the headers based on user input
        var changeColorHandler = function (evt){
            let mycolor = evt.currentTarget.value
            var elements = document.getElementsByClassName("multicolor");
            for(var i=0; i<elements.length; i++){
              elements[i].style.color = mycolor;
            }
        }
	
	var printPost = function (evt){
	    	if ('content' in document.createElement('template')) {
		    usrName = document.getElementById("UsrNme").innerText;
		    postData = document.getElementById("post").value;

    		    // Instantiate the table with the existing HTML tbody
   		    // and the row with the template
    		    var tbody = document.querySelector("tbody");
    		    var template = document.querySelector('#productrow');

    		// Clone the new row and insert it into the table
    		    var clone = template.content.cloneNode(true);
    		    var td = clone.querySelectorAll("td");
    		    td[0].textContent = usrName
		    td[1].textContent = postCount;
    		    td[2].textContent = postData;

    		    tbody.appendChild(clone);
			
		    postCount = postCount + 1;
		    document.getElementById("post").value = "";

    		} else {
  		    // Find another way to add the rows to the table because
  		    // the HTML template element is not supported.
		}
	}

        document.querySelector("#wordColor").addEventListener(
            "change",
            changeColorHandler
        )
        
    
    </script>
</body>
</html>
