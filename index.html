<!DOCTYPE html>
<html>
  <header><title>WROTiTT Forum</title></header>
  <head>
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  </head>
  
  <!-- Start of Main Body-->
  <body id="MainBod" style="background-color:black; min-height:100%">
    <style>
            div.a{
                text-align: center;
            }
    </style>
	  
    <!-- Title and Intro Div -->
    <div class="a" style="background-color:dimgrey ">
            <h1 class="multicolor" style="color:white;">WROTiTT</h1>
            <h2 class="multicolor" id="uName"></h2>
            <p></p>
    </div>
     
    <!-- Div containing 3 vertical divs -->
    <div style="background-color:dimgrey; min-height:100%">
      <!-- Social Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; min-height:100%;">
        <div class ="a" style="background-color: grey;">
            <h2 class ="multicolor">Social: Friends & Events</h2>
        </div>
            <h3 id = "correct_count">Correct Guesses</h3>
            <h2 id = "correct"></h2>
            <!-- <ul id = "correct-answers"></ul> -->

      </div>
      
      <!-- Posting and Feed div -->
      <div class ="a" style = "display: inline-block; *display: inline; width: 60%; background-color: silver; vertical-align: top; height:100%;">
            <h2 class ="multicolor">Feed: Posts & Comments</h2>
	    Welcome, <b id="UsrNme">--</b>
	    <p></p>
            Type what you want to post: <input type="text" id="post">
	    <button onclick = "printPost()">Post</button>
	    <p></p>
	    <button onclick = "getPost()">Refresh Posts</button>
	    <p></p>
	    <div id="producttable">
	    </div>
	      
	    <template id="productrow">
 	      <div>
    		<h3 style="text-align: left"></h3>
		<p style="text-align: center"></p>
		<h5 style="text-align: right"></h5>
		<div></div>
	      </div>
	      <div style="width:100%">
	      <button> Like </button> or <b>Comment:</b><input style = "display: inline-block; *display: inline;" type:"text"><button style = "display: inline-block; *display: inline;">Submit Comment</button>
	      </div>
	    </template>
	      
	    <template class="commentPost" id="productComment">
	      <div style = "display: inline-block; *display: inline; background-color: silver; width:20%;"></div>
	      <div style = "display: inline-block; *display: inline; background-color: silver; width:80%;">
		<h4 style="text-align: left"></h4>
		<p style="text-align: center"></p>
		<h5 style="text-align: right"></h5>
	      </div>
	    </template>
      </div>
      
      <!-- Profile Options Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; height: 100%;">
        <div class="a" style="background-color: grey;">
          <h2 class ="multicolor">User: Profile and Options</h2>
            </div>
	    <h3 id = "profName"></h3>
            Name: <input type = "text" id = "name">
            <button onclick = "submitName()">Change Name</button>
            <p></p>
            Customize Word Color: <input type = "color" id = "wordColor">
            <p></p>
      </div>
          
    </div>


    <!-- Script containing functions relavant to UI -->
    <script>
	var postCount = 0;
	var glblPostCount = 0;
	var postTime = 0.0;
	var postData = "";
	var usrName = "";
	var postLikes = 0;
	var postNumArr = [5,4,3,2,1];
	    
	var postNum = 0;
	var loadNum = 5;
	    
	var likedPostNum;
	var likedPostNum1;
	var likedPostNum2;
	var likedPostNum3;
	var likedPostNum4;
        
	var add_like = function(data){
	    console.log(data);
	    $.ajax({
                method: "PUT",
                url: "postHandle.php",
		data: {"postId" : data},
                success : function(data) {
		    //console.log(data);
		    //outPost(data);
		}
	    })
	    console.log("After PUT");
	}
	    
	function getPost(){
	    var tbody = document.querySelector('#producttable');
	    tbody.innerHTML = '';
	    console.log("Before GET");
	    $.ajax({
                method: "GET",
                url: "postHandle.php",
		data: {"postNum" : postNum},
                success : function(data) {
		    console.log(data);
		    outPost(data);
		}
	    })
	    console.log("After GET");
	}

	var outPost = function(data) {
	    for(postNum=0; postNum<20;postNum+=4){
		//setName(data[postNum+1]);
		usrName = data[postNum+1];
		//setPostNum(data[postNum]);
		postCount = data[postNum];
		//setPostLikes(data[postNum+2]);
		postLikes = data[postNum+2];
		//setData(data[postNum+3]);
		postData = data[postNum+3];
	    	if ('content' in document.createElement('template')) {
    	            // Instantiate the table with the existing HTML tbody
   	            // and the row with the template
    	            var tbody = document.querySelector('#producttable');
    	            var templateP = document.querySelector('#productrow');
    		    // Clone the new row and insert it into the table
    	            var clone = templateP.content.cloneNode(true);
    	            var postDispName = clone.querySelectorAll("h3");
		    var postDispData = clone.querySelectorAll("p");
		    var postDispLikes = clone.querySelectorAll("h5");
		    var butt = clone.querySelectorAll("button");
		    //const parsed = parseInt(postCount);
		    if((postNum/4)==0){
			likedPostNum = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum);}
		    }else if((postNum/4)==1){
			likedPostNum1 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum1);}
		    }else if((postNum/4)==2){
			likedPostNum2 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum2);}
		    }else if((postNum/4)==3){
			likedPostNum3 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum3);}
		    }else if((postNum/4)==4){
			likedPostNum4 = postCount;   
			butt[0].onclick = function(){add_like(likedPostNum4);}
		    }
		    butt[0].textContent = ("Like!!");
		    butt[0].textContent = ("Comment!");
    	            postDispName[0].textContent = usrName;
		    postDispLikes[0].textContent = postLikes;
    	            postDispData[0].textContent = postData;
		    //butt[0].onclick = add_like(butt[0].previousSibling.previousSibling.previousSibling.previousSibling.textContent);
    	            tbody.appendChild(clone);
    	        } else {
  	            // Find another way to add the rows to the table because
  	            // the HTML template element is not supported.
	        }
	    }
	}
		
	
        //function used to change introduction based on user input name
        var submitName = function (){
	    console.log("Changing Name");
            document.getElementById("uName").innerText = "What's on your mind, " + document.getElementById("name").value + "? Read / Write about it?" ;
	    document.getElementById("profName").innerText = document.getElementById("name").value + "'s Preferences:";
	    document.getElementById("UsrNme").innerText = document.getElementById("name").value;
            $.ajax({
                method: "POST",
                url: "cheatsheet.php",
                data: { "receiver_name": document.getElementById("name").value},
                success : function(data) {
                    
                }
            })
        }

        //function used to change the color of the headers based on user input
        var changeColorHandler = function (evt){
            let mycolor = evt.currentTarget.value
            var elements = document.getElementsByClassName("multicolor");
            for(var i=0; i<elements.length; i++){
              elements[i].style.color = mycolor;
            }
        }
	
	var clearPosts = function(){
	    var tbody = document.querySelector("tbody");
	    tbody.innerHTML = '';
	}
	
	var printPost = function (){
	    $.ajax({
                method: "POST",
                url: "postHandle.php",
                data: { "postName": document.getElementById("UsrNme").innerText, "postText": document.getElementById("post").value},
                success : function(data) {
                    
                }
            })
	    document.getElementById("post").value = "";
	    //getPost();
	}

        document.querySelector("#wordColor").addEventListener(
            "change",
            changeColorHandler
        )
        
    
    </script>
</body>
</html>
