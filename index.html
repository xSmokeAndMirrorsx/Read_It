<!DOCTYPE html>
<html>
  <header><title>WROTiTT Forum</title></header>
  <head>
    <style>
      .hidden {
        display: none;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  </head>
  
  <!-- Start of Main Body-->
  <body id="MainBod" style="background-color:black; min-height:100%">
    <style>
            div.a{
                text-align: center;
            }
    </style>
    
    <script>
        $.ajax({
                url: "cheatsheet.php",
                method: "GET",
                success : function(data) {
                    console.log(data);
                    console.log(data[0]);
                    console.log(data[1]);
                    console.log(data[2]);
                    console.log(data[3]);
                    console.log(data[4]);
                    if(data != undefined && data != "Empty"){
                        if(data[0] != null){
                            document.getElementById("uName").innerText = "What's on your mind, "+data[0]+"? Read / Write about it?" ;
			    document.getElementById("profName").innerText = data[0] + "'s Preferences:";
                        }
                        else{
                            document.getElementById("uName").innerText = "An Open Forum Site For You to Share Your Ideas on Anything!" ;
			    document.getElementById("profName").innerText = "Your Preferences:";
                        }
                        if(data[1] != null){
                            setRack(data[1]);
                        }
                        if(data[3] != null){
                            setGuesses(data[3]);
                        }
                        if(data[2] != null){
                            handleData(data[2]);
                        }
                       
                        if(data[4] != null){
                            setWordLengthCount(data[4]);
                        }
                    }             
                }
            })
    </script>
    
    <!-- Title and Intro Div -->
    <div class="a" style="background-color:dimgrey ">
            <h1 class="multicolor" style="color:white;">WROTiTT</h1>
            <h2 class="multicolor" id="uName"></h2>
            <p></p>
    </div>
     
    <!-- Div containing 3 vertical divs -->
    <div style="background-color:dimgrey; min-height:100%">
      <!-- Social Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; min-height:100%;">
        <div class ="a" style="background-color: grey;">
            <h2 class ="multicolor">Social: Friends & Events</h2>
        </div>
            <h3 id = "correct_count">Correct Guesses</h3>
            <h2 id = "correct"></h2>
            <!-- <ul id = "correct-answers"></ul> -->

      </div>
      
      <!-- Posting and Feed div -->
      <div class ="a" style = "display: inline-block; *display: inline; width: 60%; background-color: silver; vertical-align: top; height:100%;">
            <h2 class ="multicolor">Feed: Posts & Comments</h2>
	    <p></p>
            Type what you want to post: <input type="text" id="post">
	    <p></p>
	    <!--"randomRackGenerator()">Post</button>-->
	    <button onclick = "printPost()">Post</button>
	    <p></p>
	    <table id="producttable">
  	      <thead>
    		<tr>
     		  <td>UserName:</td>
      		  <td>Time / Post Number</td>
      		  <td>Post Text:</td>
   		</tr>
 	      </thead>
 	      <tbody>
   		 <!-- existing data could optionally be included here -->
 	      </tbody>
	    </table>
	      
	    <template id="productrow">
 	      <tr>
    		<td class="record"></td>
    		<td></td>
		<td></td>
  	      </tr>
	    </template>
	      
      </div>
      
      <!-- Profile Options Div -->
      <div class ="a" style="display: inline-block; *display: inline; width: 19%; background-color: slategrey; vertical-align: top; height: 100%;">
        <div class="a" style="background-color: grey;">
          <h2 class ="multicolor">User: Profile and Options</h2>
            </div>
	    <h3 id = "profName"></h3>
            Name: <input type = "text" id = "name">
            <button onclick = "submitName()">Change Name</button>
            <p></p>
            Customize Word Color: <input type = "color" id = "wordColor">
            <p></p>
      </div>
          
    </div>


    <!-- Script containing functions relavant to UI -->
    <script>
        var rackSize = 0;
        var count_of_Correct = 0;
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var charactersLength = characters.length;
        var result = new Array(7);
        var resultString = "";
        var wordList = new Array();
        var correctGuessList = new Array();
        var wordLengthCount =[0,0,0,0,0,0,0];
	    
	var postCount = 0;
	var time = 0;
	var postData = "";
        
	    
	var newPost = function (data){
	    	postData = data;
		time = postCount;
	}
	    
        // Gets a rack of 7 letters and puts it on screen
        var setRack = function (data){
            result = data;
            document.getElementById("Rack").innerText = data;
        }

        // sets the count of words left to guess by length
        var setWordLengthCount = function (data){
            wordLengthCount = data;
            document.getElementById("length").innerText = "One Letter:"+wordLengthCount[0]+"\nTwo Letters:"+wordLengthCount[1]+"\nThree Letters:"+wordLengthCount[2]+"\nFour Letters:"+wordLengthCount[3]+"\nFive Letters:"+wordLengthCount[4]+"\nSix Letters:"+wordLengthCount[5]+"\nSeven Letters:"+wordLengthCount[6]; 
        }

        // sets the count of correct guesses and correct guess list
        var setGuesses = function (data){
            correctGuessList = data;
            document.getElementById("correct").innerText = correctGuessList;
            count_of_Correct = correctGuessList.length;
            document.getElementById("correct_count").innerText = "Correct Guesses: " + count_of_Correct;
        }

        // function initializes values for variables and actually generates rack
        var randomRackGenerator = function (evt){
            for ( var i = 0; i < 7; i++ ) {
                result[i] = characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            result.sort();
            wordLengthCount =[0,0,0,0,0,0,0];
            correctGuessList = [];
            document.getElementById("correct").innerText = correctGuessList;
            count_of_Correct = 0;
            document.getElementById("correct_count").innerText = "Correct Guesses: " + count_of_Correct;
            resultString =result.join('');
            document.getElementById("Rack").innerText = result;
            
            $.ajax({
                method: "GET",
                url: "api.php",
                data: { "receiver": resultString},
                success : function(data) {
                    handleData(data);
                }
            })  
        }

        //function checks to make sure there are possible words and populates the list of count by length
        var handleData = function(data) {
            wordList = handleDuplicates(data);
            if(wordList == null || wordList == []){
                document.getElementById("length").innerText = "This rack has no possible words, please generate another rack";
            }
            console.log(wordList);
            // Create list elements for each word
            wordList.forEach( function(word) {
                wordLengthCount[word.length-1] = wordLengthCount[word.length-1] +1;
                document.getElementById("length").innerText = "One Letter:"+wordLengthCount[0]+"\nTwo Letters:"+wordLengthCount[1]+"\nThree Letters:"+wordLengthCount[2]+"\nFour Letters:"+wordLengthCount[3]+"\nFive Letters:"+wordLengthCount[4]+"\nSix Letters:"+wordLengthCount[5]+"\nSeven Letters:"+wordLengthCount[6];
            });
            $.ajax({
                method: "POST",
                url: "cheetsheet.php",
                data: { "receiver_name": document.getElementById("name").value,"rack":result,"wordList":wordList,"correctGuesses":correctGuessList,"wordLengthCount":wordLengthCount},
                success : function(data) {
                    
                }
            })
        }
        
        // Used to delete duplicates in the array.
        var handleDuplicates = function(data) {
            let newArray = [];
            data.forEach( function(word){
                if(!newArray.includes(word)){
                    newArray.push(word)
                }
            })
            return newArray;
        }
        
        //function used to check user guess against real words list
        var checkRack = function (evt){
            var fee = document.getElementById("post").value;
            fee = fee.toUpperCase();
            if(wordList.includes(fee,0) && correctGuessList.includes(fee,0) == 0){
              if(correctGuessList.length % 3 == 0 && correctGuessList.length != 0){
                fee = "\n"+ fee;
              }
              else if(correctGuessList.length != 0){
                fee = " " +fee;
              }
                correctGuessList.push(fee);
                document.getElementById("correct").innerText = correctGuessList;
                count_of_Correct ++;
                document.getElementById("correct_count").innerText = "Correct Guesses: " + count_of_Correct;
                wordLengthCount[fee.length-1] = wordLengthCount[fee.length-1] -1;
                document.getElementById("length").innerText = "One Letter:"+wordLengthCount[0]+"\nTwo Letters:"+wordLengthCount[1]+"\nThree Letters:"+wordLengthCount[2]+"\nFour Letters:"+wordLengthCount[3]+"\nFive Letters:"+wordLengthCount[4]+"\nSix Letters:"+wordLengthCount[5]+"\nSeven Letters:"+wordLengthCount[6]; 
            }
            $.ajax({
                method: "POST",
                url: "cheatsheet.php",
                data: { "receiver_name": document.getElementById("name").value,"rack":result,"wordList":wordList,"correctGuesses":correctGuessList,"wordLengthCount":wordLengthCount},
                success : function(data) {
                    
                }
            })
        }

        //function used to change introduction based on user input name
        var submitName = function (data){
            document.getElementById("uName").innerText = "What's on your mind, " + document.getElementById("name").value + "? Read / Write about it?" ;
	    document.getElementById("profName").innerText = document.getElementById("name").value + "'s Preferences:";
            $.ajax({
                method: "POST",
                url: "cheatsheet.php",
                data: { "receiver_name": document.getElementById("name").value,"rack":result,"wordList":wordList,"correctGuesses":correctGuessList,"wordLengthCount":wordLengthCount},
                success : function(data) {
                    
                }
            })
        }

        //function used to change the color of the headers based on user input
        var changeColorHandler = function (evt){
            let mycolor = evt.currentTarget.value
            var elements = document.getElementsByClassName("multicolor");
            for(var i=0; i<elements.length; i++){
              elements[i].style.color = mycolor;
            }
        }
	
	var printPost = function (evt){
	    	if ('content' in document.createElement('template')) {

    		    // Instantiate the table with the existing HTML tbody
   		    // and the row with the template
    		    var tbody = document.querySelector("tbody");
    		    var template = document.querySelector('#productrow');

    		// Clone the new row and insert it into the table
    		    var clone = template.content.cloneNode(true);
    		    var td = clone.querySelectorAll("td");
    		    td[0].textContent = document.getElementById("name").value;
		    td[1].textContent = postCount;
    		    td[2].textContent = document.getElementById("post").value;

    		    tbody.appendChild(clone);
			
    		    var clone2 = template.content.cloneNode(true);
    		    td = clone2.querySelectorAll("td");
    		    td[0].textContent = "";
		    td[1].textContent = "";
    		    td[2].textContent = "";

    		    tbody.appendChild(clone2);
			
		    postCount = postCount + 1;
		    document.getElementById("post").value = "";

    		} else {
  		    // Find another way to add the rows to the table because
  		    // the HTML template element is not supported.
		}
	}

        document.querySelector("#wordColor").addEventListener(
            "change",
            changeColorHandler
        )
        
    
    </script>
</body>
</html>
